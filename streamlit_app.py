# streamlit ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜¸ì¶œ
import streamlit as st

# --- í˜ì´ì§€ ì„¤ì • ---
st.set_page_config(
    page_title="MBTI í•™ìŠµ ìœ í˜• ì§„ë‹¨",
    page_icon="ğŸ§ ",
    layout="centered"
)

# --- ì•± ì œëª© ---
st.title("ğŸ‘¨â€ğŸ’» MBTI í•™ìŠµ ìœ í˜• ì§„ë‹¨ ğŸ‘©â€ğŸ’»")
st.markdown("---")

# --- MBTI ë¬¸í•­ ì •ì˜ ---
# ê° ë¬¸í•­ì€ ì§ˆë¬¸, ë‘ ê°€ì§€ ì„ íƒì§€, ê·¸ë¦¬ê³  ê° ì„ íƒì§€ê°€ ì†í•˜ëŠ” MBTI ì°¨ì›ì„ í¬í•¨í•©ë‹ˆë‹¤.
questions = [
    {
        "question": "1. ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ ì–´ìš¸ë¦¬ëŠ” ê²ƒì´ ì¦ê²ë‹¤.",
        "options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],
        "dimension": ("E", "I")  # ì™¸í–¥(E) / ë‚´í–¥(I)
    },
    {
        "question": "2. ìƒˆë¡œìš´ ì•„ì´ë””ì–´ë‚˜ ì´ë¡ ì— ëŒ€í•´ ê¹Šì´ ìƒê°í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤.",
        "options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],
        "dimension": ("N", "S")  # ì§ê´€(N) / ê°ê°(S)
    },
    {
        "question": "3. ê²°ì •ì„ ë‚´ë¦´ ë•Œ ë…¼ë¦¬ì ì´ê³  ê°ê´€ì ì¸ ì‚¬ì‹¤ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•œë‹¤.",
        "options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],
        "dimension": ("T", "F")  # ì‚¬ê³ (T) / ê°ì •(F)
    },
    {
        "question": "4. ê³„íšì„ ì„¸ìš°ê³  ì²´ê³„ì ìœ¼ë¡œ ì¼ì„ ì§„í–‰í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•œë‹¤.",
        "options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],
        "dimension": ("J", "P")  # íŒë‹¨(J) / ì¸ì‹(P)
    },
    {
        "question": "5. ì²˜ìŒ ë§Œë‚˜ëŠ” ì‚¬ëŒì—ê²Œ ë¨¼ì € ë‹¤ê°€ê°€ ëŒ€í™”í•˜ëŠ” ê²ƒì´ í¸í•˜ë‹¤.",
        "options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],
        "dimension": ("E", "I")
    },
    {
        "question": "6. ê²½í—˜ì„ í†µí•´ ë°°ìš°ëŠ” ê²ƒë³´ë‹¤ ê°œë…ê³¼ ì›ë¦¬ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•˜ë‹¤.",
        "options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],
        "dimension": ("N", "S")
    },
    {
        "question": "7. ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ì— ê³µê°í•˜ê³ , ê·¸ë“¤ì˜ ì…ì¥ì—ì„œ ìƒê°í•˜ë ¤ ë…¸ë ¥í•œë‹¤.",
        "options": ["ì•„ë‹ˆë‹¤", "ê·¸ë ‡ë‹¤"],  # T/F ìˆœì„œ ì£¼ì˜
        "dimension": ("T", "F")
    },
    {
        "question": "8. ì¦‰í¥ì ìœ¼ë¡œ ìƒí™©ì— ë§ì¶° í–‰ë™í•˜ëŠ” ê²ƒì„ ì¦ê¸´ë‹¤.",
        "options": ["ì•„ë‹ˆë‹¤", "ê·¸ë ‡ë‹¤"],  # J/P ìˆœì„œ ì£¼ì˜
        "dimension": ("J", "P")
    }
]

# --- MBTI ìœ í˜•ë³„ í•™ìŠµ ìŠ¤íƒ€ì¼ ì„¤ëª… ---
learning_styles = {
    "ISTJ": "**ì†Œê¸ˆí˜• ğŸ§‚:** ì‚¬ì‹¤ì— ê·¼ê±°í•˜ì—¬ ì²´ê³„ì ìœ¼ë¡œ í•™ìŠµí•˜ë©°, ê¾¸ì¤€í•˜ê³  ì‹ ì¤‘í•œ ë…¸ë ¥ì„ í†µí•´ ì§€ì‹ì„ ìŒ“ì•„ê°‘ë‹ˆë‹¤. ëª…í™•í•œ ëª©í‘œì™€ ê³„íšì„ ì„ í˜¸í•©ë‹ˆë‹¤.",
    "ISFJ": "**ê¶Œë ¥í˜• ğŸ’ª:** ë‹¤ë¥¸ ì‚¬ëŒë“¤ì„ ë•ê³  ì§€ì›í•˜ë©´ì„œ í•™ìŠµí•  ë•Œ ê°€ì¥ íš¨ê³¼ì ì…ë‹ˆë‹¤. ì‹¤ìš©ì ì´ê³  êµ¬ì²´ì ì¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì°¨ê·¼ì°¨ê·¼ í•™ìŠµí•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤.",
    "INFJ": "**ì˜ˆì–¸ìí˜• ğŸ”®:** ê¹Šì€ í†µì°°ë ¥ê³¼ ì§ê´€ì„ í†µí•´ ë³µì¡í•œ ê°œë…ì„ ì´í•´í•©ë‹ˆë‹¤. ìì‹ ë§Œì˜ ë¹„ì „ê³¼ ê°€ì¹˜ë¥¼ í•™ìŠµì— ì—°ê²°ì‹œí‚¤ë ¤ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.",
    "INTJ": "**ê³¼í•™ìí˜• ğŸ”¬:** ë…¼ë¦¬ì ì´ê³  ë¶„ì„ì ì¸ ì‚¬ê³ ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹œìŠ¤í…œ ì „ì²´ë¥¼ ì´í•´í•˜ë ¤ í•©ë‹ˆë‹¤. ë…ë¦½ì ìœ¼ë¡œ í•™ìŠµí•˜ë©°, íš¨ìœ¨ì„±ê³¼ ë…ì°½ì„±ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤.",
    "ISTP": "**ë°±ê³¼ì‚¬ì „í˜• ğŸ“–:** ì§ì ‘ ê²½í—˜í•˜ê³  ë¬¸ì œë¥¼ í•´ê²°í•˜ë©° ë°°ìš°ëŠ” ê²ƒì„ ì„ í˜¸í•©ë‹ˆë‹¤. ì‹¤ìš©ì ì¸ ê¸°ìˆ ê³¼ ì›ë¦¬ì— ê´€ì‹¬ì´ ë§ìœ¼ë©°, ìœ ì—°í•œ ì‚¬ê³ ë¥¼ ê°€ì§‘ë‹ˆë‹¤.",
    "ISFP": "**ì„±ì¸êµ°ìí˜• ğŸ˜‡:** ì¡°í™”ë¡œìš´ í™˜ê²½ì—ì„œ ìì‹ ì˜ ê°€ì¹˜ì™€ ì¼ì¹˜í•˜ëŠ” ë‚´ìš©ì„ í•™ìŠµí•  ë•Œ ë™ê¸°ë¶€ì—¬ë¥¼ ë°›ìŠµë‹ˆë‹¤. ê´€ì°°ê³¼ ì‹¤ìŠµì„ í†µí•´ ë¶€ë“œëŸ½ê²Œ ì§€ì‹ì„ ìŠµë“í•©ë‹ˆë‹¤.",
    "INFP": "**ì”ë‹¤ë¥´í¬í˜• ğŸ‘©â€ğŸŒ¾:** ìì‹ ì˜ ì´ìƒê³¼ ê°€ì¹˜ë¥¼ ì‹¤í˜„í•  ìˆ˜ ìˆëŠ” í•™ìŠµì— ëª°ë‘í•©ë‹ˆë‹¤. ì°½ì˜ì ì´ê³  ìƒìƒë ¥ì´ í’ë¶€í•˜ë©°, ê°œë³„í™”ëœ í•™ìŠµ í™˜ê²½ì„ ì„ í˜¸í•©ë‹ˆë‹¤.",
    "INTP": "**ì•„ì´ë””ì–´í˜•ğŸ’¡:** ì§€ì  í˜¸ê¸°ì‹¬ì´ ê°•í•˜ë©°, ë…¼ë¦¬ì  ë¶„ì„ê³¼ ì¶”ìƒì ì¸ ê°œë… íƒêµ¬ë¥¼ ì¦ê¹ë‹ˆë‹¤. ë³µì¡í•œ ì´ë¡ ì„ ì´í•´í•˜ê³  ìƒˆë¡œìš´ ì•„ì´ë””ì–´ë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” ë° ëŠ¥ìˆ™í•©ë‹ˆë‹¤.",
    "ESTP": "**í™œë™ê°€í˜• ğŸƒ:** ì§ì ‘ ë¶€ë”ªíˆê³  ê²½í—˜í•˜ë©° ë°°ìš°ëŠ” ì‹¤ì²œê°€ì…ë‹ˆë‹¤. ì—­ë™ì ì´ê³  ì¬ë¯¸ìˆëŠ” í•™ìŠµ í™˜ê²½ì—ì„œ ê°€ì¥ ë†’ì€ íš¨ìœ¨ì„ ë³´ì´ë©°, ë¬¸ì œ í•´ê²°ì— ê°•í•©ë‹ˆë‹¤.",
    "ESFP": "**ì‚¬êµí˜• ğŸ¤:** ì‚¬ëŒë“¤ê³¼ êµë¥˜í•˜ê³  í˜‘ë ¥í•˜ë©° ë°°ìš°ëŠ” ê²ƒì„ ì¦ê¹ë‹ˆë‹¤. ê¸ì •ì ì´ê³  í™œê¸°ì°¬ ë¶„ìœ„ê¸°ì—ì„œ ì‹¤ìš©ì ì¸ ì§€ì‹ì„ ìŠµë“í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•©ë‹ˆë‹¤.",
    "ENFP": "**ìŠ¤íŒŒí¬í˜• âœ¨:** ì—´ì •ì ìœ¼ë¡œ ìƒˆë¡œìš´ ê°€ëŠ¥ì„±ì„ íƒìƒ‰í•˜ë©° ë°°ì›ë‹ˆë‹¤. ì°½ì˜ì ì¸ ì•„ì´ë””ì–´ë¥¼ ììœ ë¡­ê²Œ íƒêµ¬í•˜ê³ , ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ì˜ê°ì„ ì£¼ê³ ë°›ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤.",
    "ENTP": "**ë°œëª…ê°€í˜• ğŸ‘¨â€ğŸ”¬:** ì§€ì ì¸ ë„ì „ì„ ì¦ê¸°ë©°, ë…¼ìŸê³¼ í† ë¡ ì„ í†µí•´ ì•„ì´ë””ì–´ë¥¼ ë°œì „ì‹œí‚µë‹ˆë‹¤. ê¸°ì¡´ì˜ ë°©ì‹ì— ì˜ë¬¸ì„ ì œê¸°í•˜ê³  ìƒˆë¡œìš´ í•´ê²°ì±…ì„ ì°¾ëŠ” ë° ë›°ì–´ë‚©ë‹ˆë‹¤.",
    "ESTJ": "**ì‚¬ì—…ê°€í˜• ğŸ¢:** ëª…í™•í•œ ëª©í‘œì™€ êµ¬ì¡°í™”ëœ ê³„íšì— ë”°ë¼ í•™ìŠµí•©ë‹ˆë‹¤. ì‹¤ìš©ì ì´ê³  íš¨ìœ¨ì ì¸ ë°©ë²•ì„ ì„ í˜¸í•˜ë©°, í•™ìŠµí•œ ë‚´ìš©ì„ í˜„ì‹¤ì— ì ìš©í•˜ëŠ” ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.",
    "ESFJ": "**ì¹œì„ ë„ëª¨í˜• ğŸ¤—:** ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ì˜ ê´€ê³„ ì†ì—ì„œ í˜‘ë ¥í•˜ë©° ë°°ìš°ëŠ” ê²ƒì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•©ë‹ˆë‹¤. ì¡°í™”ë¡œìš´ ë¶„ìœ„ê¸°ì—ì„œ ì‹¤ì§ˆì ì¸ ë„ì›€ì„ ì£¼ê³ ë°›ìœ¼ë©° ì„±ì¥í•©ë‹ˆë‹¤.",
    "ENFJ": "**ì–¸ë³€ëŠ¥ìˆ™í˜• ğŸ¤:** ë‹¤ë¥¸ ì‚¬ëŒë“¤ì„ ì´ëŒê³  ì˜ê°ì„ ì£¼ë©° í•¨ê»˜ ì„±ì¥í•˜ëŠ” í•™ìŠµì„ ì„ í˜¸í•©ë‹ˆë‹¤. ì‚¬ëŒë“¤ì˜ ì ì¬ë ¥ì„ ì´ëŒì–´ë‚´ëŠ” ë° ì—´ì •ì ì´ë©°, êµìœ¡ì ì¸ ì—­í• ì„ ì¦ê¹ë‹ˆë‹¤.",
    "ENTJ": "**ì§€ë„ìí˜• ğŸ‘‘:** ì¥ê¸°ì ì¸ ë¹„ì „ì„ ì„¸ìš°ê³ , ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ ì „ëµì ìœ¼ë¡œ í•™ìŠµí•©ë‹ˆë‹¤. ë„ì „ì ì¸ ê³¼ì œë¥¼ í•´ê²°í•˜ë©° ë¦¬ë”ì‹­ì„ ë°œíœ˜í•  ë•Œ ê°€ì¥ í¬ê²Œ ì„±ì¥í•©ë‹ˆë‹¤."
}

# --- ì•± ì‹¤í–‰ ë¡œì§ ---
# session_state ì´ˆê¸°í™”
if 'mbti_result' not in st.session_state:
    st.session_state.mbti_result = None
if 'user_answers' not in st.session_state:
    st.session_state.user_answers = {}

# í¼(Form) ìƒì„±: ì—¬ëŸ¬ ìœ„ì ¯ì„ ê·¸ë£¹í™”í•˜ì—¬ í•œ ë²ˆì— ì œì¶œ
with st.form("mbti_form"):
    # ê° ë¬¸í•­ì— ëŒ€í•´ ë¼ë””ì˜¤ ë²„íŠ¼ ìƒì„±
    for i, item in enumerate(questions):
        # st.session_stateì— ì €ì¥ëœ ì´ì „ ë‹µë³€ì´ ìˆìœ¼ë©´ ê·¸ ê°’ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©
        previous_answer_index = 0  # ê¸°ë³¸ê°’ 'ê·¸ë ‡ë‹¤'
        if f"q_{i}" in st.session_state.user_answers:
            if st.session_state.user_answers[f"q_{i}"] == item["options"][1]:
                previous_answer_index = 1

        answer = st.radio(
            label=item["question"],
            options=item["options"],
            key=f"q_{i}",
            index=previous_answer_index, # ì´ì „ì— ì„ íƒí•œ ë‹µë³€ ìœ ì§€
            horizontal=True,
        )
        # ì‚¬ìš©ìì˜ ë‹µë³€ì„ session_stateì— ì‹¤ì‹œê°„ìœ¼ë¡œ ì €ì¥
        st.session_state.user_answers[f"q_{i}"] = answer

    # ì œì¶œ ë²„íŠ¼
    submitted = st.form_submit_button("ê²°ê³¼ ë³´ê¸°")

# ì œì¶œ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ì‹¤í–‰ë  ë¡œì§
if submitted:
    # MBTI ì ìˆ˜ ê³„ì‚°
    scores = {'E': 0, 'I': 0, 'S': 0, 'N': 0, 'T': 0, 'F': 0, 'J': 0, 'P': 0}
    for i, item in enumerate(questions):
        user_answer = st.session_state.user_answers.get(f"q_{i}")
        option_index = item["options"].index(user_answer)
        dimension = item["dimension"][option_index]
        scores[dimension] += 1

    # ìµœì¢… MBTI ìœ í˜• ê²°ì •
    mbti = ""
    mbti += "E" if scores["E"] > scores["I"] else "I"
    mbti += "N" if scores["N"] > scores["S"] else "S"
    mbti += "T" if scores["T"] > scores["F"] else "F"
    mbti += "J" if scores["J"] > scores["P"] else "P"
    
    # ê²°ê³¼ë¥¼ session_stateì— ì €ì¥
    st.session_state.mbti_result = mbti

# session_stateì— ê²°ê³¼ê°€ ìˆìœ¼ë©´ í™”ë©´ì— í‘œì‹œ
if st.session_state.mbti_result:
    st.markdown("---")
    st.subheader("ğŸ‰ ë‹¹ì‹ ì˜ MBTI í•™ìŠµ ìœ í˜•ì€...")
    
    result_mbti = st.session_state.mbti_result
    st.markdown(f"### ğŸ‘‰ **{result_mbti}**")
    
    # ìœ í˜•ì— ë§ëŠ” í•™ìŠµ ìŠ¤íƒ€ì¼ ì„¤ëª… ì¶œë ¥
    if result_mbti in learning_styles:
        st.markdown(learning_styles[result_mbti])
    else:
        st.write("ê²°ê³¼ì— í•´ë‹¹í•˜ëŠ” í•™ìŠµ ìœ í˜• ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")