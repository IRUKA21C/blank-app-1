# streamlit ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜¸ì¶œ
import streamlit as st

# --- í˜ì´ì§€ ì„¤ì • ---
# st.set_page_configëŠ” ë°˜ë“œì‹œ ìŠ¤í¬ë¦½íŠ¸ì˜ ì²« Streamlit ëª…ë ¹ì–´ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
st.set_page_config(
    page_title="ğŸ¨ MBTI í•™ìŠµ ìœ í˜• ì§„ë‹¨",
    page_icon="ğŸ§ ",
    layout="centered",
    initial_sidebar_state="auto"
)

# --- ìƒíƒœ ì´ˆê¸°í™” í•¨ìˆ˜ ---
# 'ë‹¤ì‹œí•˜ê¸°' ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ í˜ì´ì§€ê°€ ì²˜ìŒ ë¡œë“œë  ë•Œ í˜¸ì¶œë©ë‹ˆë‹¤.
def initialize_state():
    st.session_state.clear() # ëª¨ë“  ì„¸ì…˜ ìƒíƒœë¥¼ ì´ˆê¸°í™”
    st.session_state.current_page = 'home'
    st.session_state.mbti_result = None
    st.session_state.user_answers = {}

# --- ë°ì´í„° ì •ì˜ ---
# MBTI ë¬¸í•­ ë°ì´í„° (ì´ì „ê³¼ ë™ì¼)
questions = [
    {"question": "1. ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ ì–´ìš¸ë¦¬ëŠ” ê²ƒì´ ì¦ê²ë‹¤.","options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],"dimension": ("E", "I")},
    {"question": "2. ìƒˆë¡œìš´ ì•„ì´ë””ì–´ë‚˜ ì´ë¡ ì— ëŒ€í•´ ê¹Šì´ ìƒê°í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤.","options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],"dimension": ("N", "S")},
    {"question": "3. ê²°ì •ì„ ë‚´ë¦´ ë•Œ ë…¼ë¦¬ì ì´ê³  ê°ê´€ì ì¸ ì‚¬ì‹¤ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•œë‹¤.","options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],"dimension": ("T", "F")},
    {"question": "4. ê³„íšì„ ì„¸ìš°ê³  ì²´ê³„ì ìœ¼ë¡œ ì¼ì„ ì§„í–‰í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•œë‹¤.","options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],"dimension": ("J", "P")},
    {"question": "5. ì²˜ìŒ ë§Œë‚˜ëŠ” ì‚¬ëŒì—ê²Œ ë¨¼ì € ë‹¤ê°€ê°€ ëŒ€í™”í•˜ëŠ” ê²ƒì´ í¸í•˜ë‹¤.","options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],"dimension": ("E", "I")},
    {"question": "6. ê²½í—˜ì„ í†µí•´ ë°°ìš°ëŠ” ê²ƒë³´ë‹¤ ê°œë…ê³¼ ì›ë¦¬ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•˜ë‹¤.","options": ["ê·¸ë ‡ë‹¤", "ì•„ë‹ˆë‹¤"],"dimension": ("N", "S")},
    {"question": "7. ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ì— ê³µê°í•˜ê³ , ê·¸ë“¤ì˜ ì…ì¥ì—ì„œ ìƒê°í•˜ë ¤ ë…¸ë ¥í•œë‹¤.","options": ["ì•„ë‹ˆë‹¤", "ê·¸ë ‡ë‹¤"],"dimension": ("T", "F")},
    {"question": "8. ì¦‰í¥ì ìœ¼ë¡œ ìƒí™©ì— ë§ì¶° í–‰ë™í•˜ëŠ” ê²ƒì„ ì¦ê¸´ë‹¤.","options": ["ì•„ë‹ˆë‹¤", "ê·¸ë ‡ë‹¤"],"dimension": ("J", "P")}
]
# MBTI ìœ í˜•ë³„ í•™ìŠµ ìŠ¤íƒ€ì¼ ì„¤ëª… (ì´ì „ê³¼ ë™ì¼)
learning_styles = {
    "ISTJ": "**ì†Œê¸ˆí˜• ğŸ§‚:** ì‚¬ì‹¤ì— ê·¼ê±°í•˜ì—¬ ì²´ê³„ì ìœ¼ë¡œ í•™ìŠµí•˜ë©°, ê¾¸ì¤€í•˜ê³  ì‹ ì¤‘í•œ ë…¸ë ¥ì„ í†µí•´ ì§€ì‹ì„ ìŒ“ì•„ê°‘ë‹ˆë‹¤. ëª…í™•í•œ ëª©í‘œì™€ ê³„íšì„ ì„ í˜¸í•©ë‹ˆë‹¤.",
    "ISFJ": "**ê¶Œë ¥í˜• ğŸ’ª:** ë‹¤ë¥¸ ì‚¬ëŒë“¤ì„ ë•ê³  ì§€ì›í•˜ë©´ì„œ í•™ìŠµí•  ë•Œ ê°€ì¥ íš¨ê³¼ì ì…ë‹ˆë‹¤. ì‹¤ìš©ì ì´ê³  êµ¬ì²´ì ì¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì°¨ê·¼ì°¨ê·¼ í•™ìŠµí•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤.",
    "INFJ": "**ì˜ˆì–¸ìí˜• ğŸ”®:** ê¹Šì€ í†µì°°ë ¥ê³¼ ì§ê´€ì„ í†µí•´ ë³µì¡í•œ ê°œë…ì„ ì´í•´í•©ë‹ˆë‹¤. ìì‹ ë§Œì˜ ë¹„ì „ê³¼ ê°€ì¹˜ë¥¼ í•™ìŠµì— ì—°ê²°ì‹œí‚¤ë ¤ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.",
    "INTJ": "**ê³¼í•™ìí˜• ğŸ”¬:** ë…¼ë¦¬ì ì´ê³  ë¶„ì„ì ì¸ ì‚¬ê³ ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹œìŠ¤í…œ ì „ì²´ë¥¼ ì´í•´í•˜ë ¤ í•©ë‹ˆë‹¤. ë…ë¦½ì ìœ¼ë¡œ í•™ìŠµí•˜ë©°, íš¨ìœ¨ì„±ê³¼ ë…ì°½ì„±ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤.",
    "ISTP": "**ë°±ê³¼ì‚¬ì „í˜• ğŸ“–:** ì§ì ‘ ê²½í—˜í•˜ê³  ë¬¸ì œë¥¼ í•´ê²°í•˜ë©° ë°°ìš°ëŠ” ê²ƒì„ ì„ í˜¸í•©ë‹ˆë‹¤. ì‹¤ìš©ì ì¸ ê¸°ìˆ ê³¼ ì›ë¦¬ì— ê´€ì‹¬ì´ ë§ìœ¼ë©°, ìœ ì—°í•œ ì‚¬ê³ ë¥¼ ê°€ì§‘ë‹ˆë‹¤.",
    "ISFP": "**ì„±ì¸êµ°ìí˜• ğŸ˜‡:** ì¡°í™”ë¡œìš´ í™˜ê²½ì—ì„œ ìì‹ ì˜ ê°€ì¹˜ì™€ ì¼ì¹˜í•˜ëŠ” ë‚´ìš©ì„ í•™ìŠµí•  ë•Œ ë™ê¸°ë¶€ì—¬ë¥¼ ë°›ìŠµë‹ˆë‹¤. ê´€ì°°ê³¼ ì‹¤ìŠµì„ í†µí•´ ë¶€ë“œëŸ½ê²Œ ì§€ì‹ì„ ìŠµë“í•©ë‹ˆë‹¤.",
    "INFP": "**ì”ë‹¤ë¥´í¬í˜• ğŸ‘©â€ğŸŒ¾:** ìì‹ ì˜ ì´ìƒê³¼ ê°€ì¹˜ë¥¼ ì‹¤í˜„í•  ìˆ˜ ìˆëŠ” í•™ìŠµì— ëª°ë‘í•©ë‹ˆë‹¤. ì°½ì˜ì ì´ê³  ìƒìƒë ¥ì´ í’ë¶€í•˜ë©°, ê°œë³„í™”ëœ í•™ìŠµ í™˜ê²½ì„ ì„ í˜¸í•©ë‹ˆë‹¤.",
    "INTP": "**ì•„ì´ë””ì–´í˜•ğŸ’¡:** ì§€ì  í˜¸ê¸°ì‹¬ì´ ê°•í•˜ë©°, ë…¼ë¦¬ì  ë¶„ì„ê³¼ ì¶”ìƒì ì¸ ê°œë… íƒêµ¬ë¥¼ ì¦ê¹ë‹ˆë‹¤. ë³µì¡í•œ ì´ë¡ ì„ ì´í•´í•˜ê³  ìƒˆë¡œìš´ ì•„ì´ë””ì–´ë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” ë° ëŠ¥ìˆ™í•©ë‹ˆë‹¤.",
    "ESTP": "**í™œë™ê°€í˜• ğŸƒ:** ì§ì ‘ ë¶€ë”ªíˆê³  ê²½í—˜í•˜ë©° ë°°ìš°ëŠ” ì‹¤ì²œê°€ì…ë‹ˆë‹¤. ì—­ë™ì ì´ê³  ì¬ë¯¸ìˆëŠ” í•™ìŠµ í™˜ê²½ì—ì„œ ê°€ì¥ ë†’ì€ íš¨ìœ¨ì„ ë³´ì´ë©°, ë¬¸ì œ í•´ê²°ì— ê°•í•©ë‹ˆë‹¤.",
    "ESFP": "**ì‚¬êµí˜• ğŸ¤:** ì‚¬ëŒë“¤ê³¼ êµë¥˜í•˜ê³  í˜‘ë ¥í•˜ë©° ë°°ìš°ëŠ” ê²ƒì„ ì¦ê¹ë‹ˆë‹¤. ê¸ì •ì ì´ê³  í™œê¸°ì°¬ ë¶„ìœ„ê¸°ì—ì„œ ì‹¤ìš©ì ì¸ ì§€ì‹ì„ ìŠµë“í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•©ë‹ˆë‹¤.",
    "ENFP": "**ìŠ¤íŒŒí¬í˜• âœ¨:** ì—´ì •ì ìœ¼ë¡œ ìƒˆë¡œìš´ ê°€ëŠ¥ì„±ì„ íƒìƒ‰í•˜ë©° ë°°ì›ë‹ˆë‹¤. ì°½ì˜ì ì¸ ì•„ì´ë””ì–´ë¥¼ ììœ ë¡­ê²Œ íƒêµ¬í•˜ê³ , ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ì˜ê°ì„ ì£¼ê³ ë°›ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤.",
    "ENTP": "**ë°œëª…ê°€í˜• ğŸ‘¨â€ğŸ”¬:** ì§€ì ì¸ ë„ì „ì„ ì¦ê¸°ë©°, ë…¼ìŸê³¼ í† ë¡ ì„ í†µí•´ ì•„ì´ë””ì–´ë¥¼ ë°œì „ì‹œí‚µë‹ˆë‹¤. ê¸°ì¡´ì˜ ë°©ì‹ì— ì˜ë¬¸ì„ ì œê¸°í•˜ê³  ìƒˆë¡œìš´ í•´ê²°ì±…ì„ ì°¾ëŠ” ë° ë›°ì–´ë‚©ë‹ˆë‹¤.",
    "ESTJ": "**ì‚¬ì—…ê°€í˜• ğŸ¢:** ëª…í™•í•œ ëª©í‘œì™€ êµ¬ì¡°í™”ëœ ê³„íšì— ë”°ë¼ í•™ìŠµí•©ë‹ˆë‹¤. ì‹¤ìš©ì ì´ê³  íš¨ìœ¨ì ì¸ ë°©ë²•ì„ ì„ í˜¸í•˜ë©°, í•™ìŠµí•œ ë‚´ìš©ì„ í˜„ì‹¤ì— ì ìš©í•˜ëŠ” ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.",
    "ESFJ": "**ì¹œì„ ë„ëª¨í˜• ğŸ¤—:** ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ì˜ ê´€ê³„ ì†ì—ì„œ í˜‘ë ¥í•˜ë©° ë°°ìš°ëŠ” ê²ƒì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•©ë‹ˆë‹¤. ì¡°í™”ë¡œìš´ ë¶„ìœ„ê¸°ì—ì„œ ì‹¤ì§ˆì ì¸ ë„ì›€ì„ ì£¼ê³ ë°›ìœ¼ë©° ì„±ì¥í•©ë‹ˆë‹¤.",
    "ENFJ": "**ì–¸ë³€ëŠ¥ìˆ™í˜• ğŸ¤:** ë‹¤ë¥¸ ì‚¬ëŒë“¤ì„ ì´ëŒê³  ì˜ê°ì„ ì£¼ë©° í•¨ê»˜ ì„±ì¥í•˜ëŠ” í•™ìŠµì„ ì„ í˜¸í•©ë‹ˆë‹¤. ì‚¬ëŒë“¤ì˜ ì ì¬ë ¥ì„ ì´ëŒì–´ë‚´ëŠ” ë° ì—´ì •ì ì´ë©°, êµìœ¡ì ì¸ ì—­í• ì„ ì¦ê¹ë‹ˆë‹¤.",
    "ENTJ": "**ì§€ë„ìí˜• ğŸ‘‘:** ì¥ê¸°ì ì¸ ë¹„ì „ì„ ì„¸ìš°ê³ , ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ ì „ëµì ìœ¼ë¡œ í•™ìŠµí•©ë‹ˆë‹¤. ë„ì „ì ì¸ ê³¼ì œë¥¼ í•´ê²°í•˜ë©° ë¦¬ë”ì‹­ì„ ë°œíœ˜í•  ë•Œ ê°€ì¥ í¬ê²Œ ì„±ì¥í•©ë‹ˆë‹¤."
}

# --- ì•± UI ë° ë¡œì§ ---

# í˜ì´ì§€ê°€ ì²˜ìŒ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
if 'current_page' not in st.session_state:
    initialize_state()

# --- ì œëª© ë° ì„¤ëª… ---
col1, col2 = st.columns([1, 5])
with col1:
    st.image("https://em-content.zobj.net/source/samsung/380/brain_1f9e0.png", width=100)
with col2:
    st.title("MBTI í•™ìŠµ ìœ í˜• ì§„ë‹¨")
    st.caption("ë‚˜ì—ê²Œ ê¼­ ë§ëŠ” í•™ìŠµ ìŠ¤íƒ€ì¼ì„ ì°¾ì•„ë³´ì„¸ìš”!")

st.divider()

# --- ê²°ê³¼ í‘œì‹œ ---
# ì§„ë‹¨ ê²°ê³¼ê°€ ì„¸ì…˜ ìƒíƒœì— ì €ì¥ë˜ì–´ ìˆëŠ” ê²½ìš°
if st.session_state.mbti_result:
    result_mbti = st.session_state.mbti_result

    # ê²°ê³¼ë¥¼ ê°•ì¡°í•˜ëŠ” ì»¨í…Œì´ë„ˆ
    with st.container(border=True):
        st.subheader(f"ğŸ‰ ë‹¹ì‹ ì˜ ìœ í˜•ì€ **'{result_mbti}'** ì…ë‹ˆë‹¤!", anchor=False)
        st.write(learning_styles.get(result_mbti, "ê²°ê³¼ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤..."))

    # ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼
    if st.button("ğŸ”„ï¸ ë‹¤ì‹œí•˜ê¸°", use_container_width=True):
        initialize_state()
        st.rerun() # í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì´ˆê¸° ìƒíƒœë¡œ ëŒì•„ê°

# --- ì„¤ë¬¸ ì‹œì‘ ---
# ì•„ì§ ì§„ë‹¨ì„ ì‹œì‘í•˜ì§€ ì•Šì€ ê²½ìš°
else:
    # ì„¤ë¬¸ì§€ë¥¼ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ
    with st.container(border=True):
        st.info("ğŸ’¡ ê° ë¬¸í•­ì— ëŒ€í•´ ì†”ì§í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”.")
        
        # í¼(Form) ìƒì„±
        with st.form("mbti_form"):
            # ê° ë¬¸í•­ì— ëŒ€í•´ ë¼ë””ì˜¤ ë²„íŠ¼ ìƒì„±
            for i, item in enumerate(questions):
                st.radio(
                    label=f'**{item["question"]}**',
                    options=item["options"],
                    key=f"q_{i}",
                    horizontal=True,
                )
            
            # ì œì¶œ ë²„íŠ¼
            submitted = st.form_submit_button("âœ”ï¸ ê²°ê³¼ ë³´ê¸°", use_container_width=True, type="primary")

    # ì œì¶œ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ì‹¤í–‰ë  ë¡œì§
    if submitted:
        # MBTI ì ìˆ˜ ê³„ì‚°
        scores = {'E': 0, 'I': 0, 'S': 0, 'N': 0, 'T': 0, 'F': 0, 'J': 0, 'P': 0}
        for i, item in enumerate(questions):
            # st.session_stateì—ì„œ ì§ì ‘ ë‹µë³€ì„ ê°€ì ¸ì˜´
            user_answer = st.session_state[f"q_{i}"]
            option_index = item["options"].index(user_answer)
            dimension = item["dimension"][option_index]
            scores[dimension] += 1

        # ìµœì¢… MBTI ìœ í˜• ê²°ì •
        mbti = ""
        mbti += "E" if scores["E"] >= scores["I"] else "I"
        mbti += "N" if scores["N"] >= scores["S"] else "S"
        mbti += "T" if scores["T"] >= scores["F"] else "F"
        mbti += "J" if scores["J"] >= scores["P"] else "P"
        
        # ê²°ê³¼ë¥¼ ì„¸ì…˜ ìƒíƒœì— ì €ì¥
        st.session_state.mbti_result = mbti
        
        # ê²°ê³¼ ì œì¶œ ì‹œ ì¶•í•˜ íš¨ê³¼
        st.balloons()
        
        # í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ê²°ê³¼ í™”ë©´ì„ í‘œì‹œ
        st.rerun()